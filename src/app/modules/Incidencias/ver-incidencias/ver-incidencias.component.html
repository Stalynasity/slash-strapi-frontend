<div class="card p-6 shadow-md rounded-md">
  <div class="text-2xl font-bold mb-5 text-primary">🔍 Detalle de Incidencia</div>

  <p-tabs value="0" class="mb-4">
    <p-tablist class="gap-3">
      <p-tab value="0">📝 Información</p-tab>
      <p-tab value="1">💡 Sugerencias</p-tab>
      <p-tab value="2">👥 Colaboración</p-tab>
    </p-tablist>

    <p-tabpanels>
      <!-- Información General -->
      <p-tabpanel value="0">
        <p-card *ngIf="incidencia" header="📄 Información General" class="w-full mt-3">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5 text-sm">
            <div><label class="text-gray-500">ID:</label>
              <p class="font-medium">{{ incidencia.id }}</p>
            </div>
            <div><label class="text-gray-500">Título:</label>
              <p class="font-medium">{{ incidencia.titulo }}</p>
            </div>
            <div class="md:col-span-2"><label class="text-gray-500">Descripción:</label>
              <p>{{ incidencia.descripcion }}</p>
            </div>
            <div><label class="text-gray-500">Tipo:</label>
              <p>{{ incidencia.tipo }}</p>
            </div>
            <div><label class="text-gray-500">Prioridad:</label>
              <p>{{ incidencia.prioridad }}</p>
            </div>
            <div>
              <label class="text-gray-500">Estado:</label>
              <p-tag [value]="incidencia.estado" [severity]="getSeveridadEstado(incidencia.estado)"
                styleClass="text-sm px-2 py-1"></p-tag>
            </div>
            <div><label class="text-gray-500">Módulo Afectado:</label>
              <p>{{ incidencia.modulo_afectado }}</p>
            </div>
            <div><label class="text-gray-500">Autor:</label>
              <p>{{ incidencia.autor_id }}</p>
            </div>
            <div><label class="text-gray-500">Responsable:</label>
              <p>{{ incidencia.responsable_id }}</p>
            </div>
            <div><label class="text-gray-500">Creado:</label>
              <p>{{ incidencia.fecha_creacion | date:'medium' }}</p>
            </div>
            <div><label class="text-gray-500">Actualizado:</label>
              <p>{{ incidencia.fecha_actualizacion | date:'medium' }}</p>
            </div>

            <div *ngIf="incidencia.archivos_adjunto?.length" class="md:col-span-2">
              <label class="text-gray-500">📎 Archivos Adjuntos:</label>
              <ul class="list-disc list-inside mt-1">
                <li *ngFor="let archivo of incidencia.archivos_adjunto">
                  <a href="#" class="text-blue-600 hover:underline">{{ archivo }}</a>
                </li>
              </ul>
            </div>
          </div>
        </p-card>
      </p-tabpanel>

      <!-- Sugerencias -->
      <p-tabpanel value="1">
        <p-card header="💡 Sugerencias Inteligentes" class="w-full mt-3">
          <ng-container *ngIf="incidencia?.sugerencias?.length; else sinSugerencias">
            <ul class="list-disc list-inside text-sm">
              <li *ngFor="let sugerencia of incidencia?.sugerencias" class="py-1">{{ sugerencia }}</li>
            </ul>
          </ng-container>
          <ng-template #sinSugerencias>
            <p class="text-gray-400">No hay sugerencias disponibles para esta incidencia.</p>
          </ng-template>
        </p-card>
      </p-tabpanel>



      <!-- Comentarios / Colaboración -->
      <p-tabpanel value="2">

        <!-- Formulario rápido (opcional) -->
        <div class="mb-5">
          <label for="nuevoComentario" class="block text-sm font-semibold text-color mb-2">
            Agregar Comentario:
          </label>

          <div class="flex flex-col md:flex-row gap-3 items-end">
            <textarea pTextarea  id="nuevoComentario" [(ngModel)]="nuevoComentario" rows="3"
              class="w-full" placeholder="Escribe aquí tu comentario..."></textarea>

            <p-button type="button" icon="pi pi-send" label="Enviar" class="md:w-auto w-full"
              (click)="agregarComentario()" [disabled]="!nuevoComentario.trim()"></p-button>
          </div>
        </div>
        <p-card header="👥 Comentarios de Colaboradores" class="w-full mt-3">

          <p-timeline [value]="comentarios" align="alternate" styleClass="customized-timeline"
            *ngIf="comentarios?.length">
            <ng-template let-comentario pTemplate="content">
              <small class="text-gray-500">{{ comentario.fecha | date: 'short' }}</small>
              <p class="mt-1">{{ comentario.contenido }}</p>
            </ng-template>
          </p-timeline>
          <ng-template #sinComentarios>
            <p class="text-gray-400">No hay comentarios registrados aún.</p>
          </ng-template>

        </p-card>
      </p-tabpanel>
    </p-tabpanels>
  </p-tabs>
</div>
